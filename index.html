<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LojinIC - Carregamento Seguro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Sistema de Erros Global (Para voc칡 ver se algo quebrou) -->
    <script>
        window.onerror = function(msg, url, line, col, error) {
            const div = document.getElementById('error-display');
            if(div) {
                div.style.display = 'block';
                div.innerHTML += `<p><strong>Erro:</strong> ${msg} <br/><small>${url}:${line}</small></p>`;
            }
            return false;
        };
    </script>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
            "firebase/database": "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; background-color: #f8fafc; }
        .custom-loader {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <!-- Container de Erros (Aparece s칩 se der ruim) -->
    <div id="error-display" style="display:none; background:#fee2e2; color:#991b1b; padding:20px; margin:10px; border-radius:8px; font-family:monospace; border:1px solid #ef4444;">
        <h3 style="font-weight:bold; margin-bottom:10px;">丘멆잺 Ocorreu um erro no carregamento:</h3>
    </div>

    <div id="root">
        <!-- Loading Inicial (HTML Puro enquanto o React carrega) -->
        <div style="height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:sans-serif; color:#64748b;">
            <div class="custom-loader"></div>
            <p style="margin-top:15px;">Iniciando LojinIC...</p>
        </div>
    </div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getAuth, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, GoogleAuthProvider, signInWithPopup } from 'firebase/auth';
        import { getDatabase, ref, push, set, get, update, remove, onValue, query, orderByChild, equalTo } from 'firebase/database';
        import { Store, ShoppingBag, Plus, Trash2, LogOut, ExternalLink, X, LayoutDashboard, ChevronRight, Package, MessageCircle, Settings, ShieldCheck, ArrowRight, Wallet, CheckCircle2, Lock, Zap, Smartphone, Globe, Copy, Search, AlertCircle } from 'lucide-react';

        // --- CONFIGURA칂츾O FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDvAcCedeELaoqybw64-DqZboSvtZqjH04",
            authDomain: "lojinic-99d2e.firebaseapp.com",
            databaseURL: "https://lojinic-99d2e-default-rtdb.firebaseio.com",
            projectId: "lojinic-99d2e",
            storageBucket: "lojinic-99d2e.firebasestorage.app",
            messagingSenderId: "170010365264",
            appId: "1:170010365264:web:94e1b369cd38ab9ed2b055"
        };

        // Inicializa칞칚o segura
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getDatabase(app);
        } catch (error) {
            console.error("Erro ao iniciar Firebase:", error);
            document.getElementById('error-display').innerHTML += `<p>Erro Firebase: ${error.message}</p>`;
            document.getElementById('error-display').style.display = 'block';
        }

        const APP_ID = 'lojinic-producao'; 
        const ADMIN_EMAIL = 'admin@lojinic.com';

        // --- UTILIT츼RIOS ---
        const formatBRL = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v);
        const getAvatar = (n) => `https://ui-avatars.com/api/?name=${encodeURIComponent(n)}&background=0f172a&color=fff&bold=true`;
        const snapshotToArray = (snapshot) => {
            if (!snapshot || !snapshot.exists()) return [];
            const data = snapshot.val();
            return Object.keys(data).map(key => ({ id: key, ...data[key] })).reverse();
        };
        const copyText = (t) => {
            try { navigator.clipboard.writeText(t); } catch(e) { prompt("Copie a chave:", t); }
        };

        // --- COMPONENTE APP ---
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('landing');
            const [activeStoreId, setActiveStoreId] = useState(null);
            const [toast, setToast] = useState(null);
            const [longLoad, setLongLoad] = useState(false);

            useEffect(() => {
                let unsub = () => {};
                
                if (auth) {
                    unsub = onAuthStateChanged(auth, (u) => {
                        setUser(u);
                        setLoading(false);
                    });
                } else {
                    // Se auth falhou, libera o app deslogado
                    setLoading(false);
                }

                const params = new URLSearchParams(window.location.search);
                if (params.get('store')) {
                    setActiveStoreId(params.get('store'));
                    setView('storefront');
                }

                // Timeout de seguran칞a visual
                const timer = setTimeout(() => {
                    if(loading) setLongLoad(true);
                }, 3000);

                return () => { unsub(); clearTimeout(timer); };
            }, []);

            const forceEnter = () => {
                setLoading(false);
            };

            const showToast = (msg, type='success') => {
                setToast({msg, type}); setTimeout(() => setToast(null), 4000);
            };

            const navigate = (targetView, storeId = null) => {
                setView(targetView);
                if (storeId) setActiveStoreId(storeId);
                const url = storeId ? `?store=${storeId}` : window.location.pathname;
                window.history.pushState({}, '', url);
            };

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-slate-50 p-4 text-center">
                    <div className="custom-loader mb-4"></div>
                    <p className="text-slate-500 font-medium mb-4">Conectando ao LojinIC...</p>
                    {longLoad && (
                        <div className="animate-fade-in">
                            <p className="text-sm text-red-400 mb-2">A conex칚o est치 lenta.</p>
                            <button onClick={forceEnter} className="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold text-sm hover:bg-slate-700">
                                Entrar Mesmo Assim
                            </button>
                        </div>
                    )}
                </div>
            );

            return (
                <>
                    {toast && (
                        <div className={`fixed top-5 right-5 z-[100] px-6 py-4 rounded-xl shadow-2xl text-white font-bold flex items-center gap-3 animate-bounce ${toast.type==='error'?'bg-red-500':'bg-emerald-600'}`}>
                            {toast.type==='error'?<AlertCircle size={20}/>:<CheckCircle2 size={20}/>} {toast.msg}
                        </div>
                    )}

                    {view === 'landing' && <LandingPage user={user} navigate={navigate} />}
                    {view === 'auth' && <AuthPage navigate={navigate} showToast={showToast} />}
                    {view === 'dashboard' && user && <Dashboard user={user} navigate={navigate} showToast={showToast} />}
                    {view === 'storefront' && activeStoreId && <Storefront storeId={activeStoreId} navigate={navigate} showToast={showToast} />}
                    {view === 'directory' && <Directory navigate={navigate} />}
                </>
            );
        }

        // --- TELAS (Simplificadas para garantir renderiza칞칚o) ---

        function LandingPage({ user, navigate }) {
            return (
                <div className="min-h-screen bg-white flex flex-col">
                    <header className="bg-white/90 backdrop-blur border-b py-4 px-6 flex justify-between items-center sticky top-0 z-40">
                        <div className="flex items-center gap-2 font-black text-xl cursor-pointer" onClick={()=>navigate('landing')}>
                            <ShoppingBag className="text-blue-600" size={24}/> LojinIC
                        </div>
                        <div className="flex gap-2">
                            <button onClick={()=>navigate('directory')} className="text-sm font-bold text-slate-600 hover:text-blue-600 px-3 py-2">Lojas</button>
                            <button onClick={()=>navigate(user ? 'dashboard' : 'auth')} className="bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-bold">
                                {user ? 'Painel' : 'Entrar'}
                            </button>
                        </div>
                    </header>
                    <main className="flex-1 flex flex-col items-center justify-center text-center px-4 py-10">
                        <h1 className="text-4xl md:text-6xl font-black text-slate-900 mb-6">Venda online <span className="text-blue-600">agora</span>.</h1>
                        <p className="text-slate-500 mb-8 max-w-md">Crie seu cat치logo e receba pedidos no WhatsApp. R치pido, f치cil e seguro.</p>
                        <div className="flex gap-4">
                            <button onClick={()=>navigate(user ? 'dashboard' : 'auth')} className="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700">Criar Loja</button>
                            <button onClick={()=>navigate('directory')} className="bg-white text-slate-700 border px-6 py-3 rounded-xl font-bold">Ver Lojas</button>
                        </div>
                    </main>
                </div>
            );
        }

        function AuthPage({ navigate, showToast }) {
            const [isReg, setIsReg] = useState(false);
            const [load, setLoad] = useState(false);
            const [f, setF] = useState({email:'', pass:'', name:''});

            const go = async (e) => {
                e.preventDefault(); setLoad(true);
                try {
                    if (!auth) throw new Error("Auth n칚o inicializado");
                    let u;
                    if(isReg) {
                        const c = await createUserWithEmailAndPassword(auth, f.email, f.pass);
                        u = c.user;
                        await updateProfile(u, {displayName: f.name});
                        await storeCheck(u, f.name);
                        showToast("Criado com sucesso!");
                    } else {
                        const c = await signInWithEmailAndPassword(auth, f.email, f.pass);
                        u = c.user;
                        showToast("Logado!");
                    }
                    navigate('dashboard');
                } catch(err) { showToast(err.message, "error"); } 
                finally { setLoad(false); }
            };

            const google = async () => {
                try {
                    const r = await signInWithPopup(auth, new GoogleAuthProvider());
                    await storeCheck(r.user, r.user.displayName);
                    navigate('dashboard');
                } catch(e) { showToast("Erro Google: " + e.message, "error"); }
            };

            const storeCheck = async (u, n) => {
                const refS = ref(db, `artifacts/${APP_ID}/public/data/stores`);
                const q = query(refS, orderByChild('ownerId'), equalTo(u.uid));
                const snap = await get(q);
                if(!snap.exists()) {
                    await set(push(refS), {
                        ownerId: u.uid, name: n || "Loja", whatsapp:"", themeColor:"#1e293b", 
                        logoUrl: getAvatar(n), paymentStatus:'pending', createdAt: Date.now()
                    });
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100 p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm">
                        <h2 className="text-2xl font-bold text-center mb-6">{isReg ? 'Criar' : 'Entrar'}</h2>
                        <form onSubmit={go} className="space-y-3">
                            {isReg && <input className="w-full border p-3 rounded-lg" placeholder="Nome Loja" value={f.name} onChange={e=>setF({...f, name:e.target.value})} required/>}
                            <input className="w-full border p-3 rounded-lg" type="email" placeholder="Email" value={f.email} onChange={e=>setF({...f, email:e.target.value})} required/>
                            <input className="w-full border p-3 rounded-lg" type="password" placeholder="Senha" value={f.pass} onChange={e=>setF({...f, pass:e.target.value})} required/>
                            <button disabled={load} className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold">{load?'...':'Confirmar'}</button>
                        </form>
                        <button onClick={google} className="w-full border py-3 rounded-lg font-bold mt-4 flex justify-center gap-2"><Globe size={20}/> Google</button>
                        <button onClick={()=>setIsReg(!isReg)} className="block mx-auto mt-4 text-blue-600 text-sm hover:underline">{isReg?'J치 tenho conta':'Criar conta'}</button>
                        <button onClick={()=>navigate('landing')} className="block mx-auto mt-2 text-slate-400 text-xs">Cancelar</button>
                    </div>
                </div>
            );
        }

        function Dashboard({ user, navigate, showToast }) {
            const [store, setStore] = useState(null);
            const [tab, setTab] = useState('prod');
            const [prods, setProds] = useState([]);
            const [newP, setNewP] = useState({name:'', price:'', img:''});
            
            // Admin
            const isAdmin = user.email === ADMIN_EMAIL;
            const [allStores, setAllStores] = useState([]);
            const [pix, setPix] = useState('');

            useEffect(() => {
                if (!db) return;
                if(isAdmin) {
                    onValue(ref(db, `artifacts/${APP_ID}/public/data/stores`), s => setAllStores(snapshotToArray(s)));
                    get(ref(db, `artifacts/${APP_ID}/public/data/saas_config`)).then(s => s.exists() && setPix(s.val().pixKey));
                } else {
                    const q = query(ref(db, `artifacts/${APP_ID}/public/data/stores`), orderByChild('ownerId'), equalTo(user.uid));
                    onValue(q, s => {
                        if(s.exists()) {
                            const d = s.val(); const k = Object.keys(d)[0];
                            setStore({id:k, ...d[k]});
                            get(ref(db, `artifacts/${APP_ID}/public/data/saas_config`)).then(sc => sc.exists() && setPix(sc.val().pixKey));
                        }
                    });
                }
            }, [user]);

            useEffect(() => {
                if(store) {
                    const q = query(ref(db, `artifacts/${APP_ID}/public/data/products`), orderByChild('storeId'), equalTo(store.id));
                    onValue(q, s => setProds(snapshotToArray(s)));
                }
            }, [store]);

            // Handlers
            const addP = async (e) => {
                e.preventDefault();
                const img = newP.img || `https://source.unsplash.com/featured/?${newP.name},product&t=${Date.now()}`;
                await set(push(ref(db, `artifacts/${APP_ID}/public/data/products`)), {
                    storeId: store.id, name: newP.name, price: parseFloat(newP.price), image: img, createdAt: Date.now()
                });
                setNewP({name:'', price:'', img:''}); showToast("Produto criado!");
            };
            const delP = async (id) => { if(confirm('Excluir?')) await remove(ref(db, `artifacts/${APP_ID}/public/data/products/${id}`)); };
            const saveConf = async (e) => {
                e.preventDefault();
                await update(ref(db, `artifacts/${APP_ID}/public/data/stores/${store.id}`), {
                    name: e.target.name.value, whatsapp: e.target.whatsapp.value, themeColor: e.target.color.value
                }); showToast("Salvo!");
            };
            
            // Admin Handlers
            const toggleSt = async (id, st) => update(ref(db, `artifacts/${APP_ID}/public/data/stores/${id}`), {paymentStatus: st==='active'?'pending':'active'});
            const savePix = async () => { await update(ref(db, `artifacts/${APP_ID}/public/data/saas_config`), {pixKey: pix}); showToast("Pix Salvo"); };

            if(isAdmin) return (
                <div className="min-h-screen bg-slate-900 text-white p-4">
                    <div className="flex justify-between mb-6 border-b border-slate-700 pb-2">
                        <h2 className="text-xl font-bold">Admin Master</h2>
                        <button onClick={()=>signOut(auth)} className="text-red-400 text-sm">Sair</button>
                    </div>
                    <div className="mb-6 bg-slate-800 p-4 rounded-lg">
                        <h3 className="font-bold mb-2">Pix Global</h3>
                        <div className="flex gap-2"><input className="bg-slate-900 border-slate-600 border p-2 rounded w-full" value={pix} onChange={e=>setPix(e.target.value)}/><button onClick={savePix} className="bg-blue-600 px-4 rounded">Salvar</button></div>
                    </div>
                    <div className="space-y-2">
                        {allStores.map(s => (
                            <div key={s.id} className="bg-slate-800 p-3 rounded flex justify-between items-center">
                                <div><b>{s.name}</b> <span className="text-xs ml-2 opacity-70">{s.paymentStatus}</span></div>
                                <div className="flex gap-2">
                                    <button onClick={()=>navigate('storefront', s.id)}><ExternalLink size={16}/></button>
                                    <button onClick={()=>toggleSt(s.id, s.paymentStatus)} className="text-xs border px-2 py-1 rounded">{s.paymentStatus==='active'?'Bloquear':'Aprovar'}</button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            if(!store) return <div className="p-10 text-center">Carregando loja...</div>;

            return (
                <div className="min-h-screen bg-slate-50 pb-20">
                    <header className="bg-white border-b p-4 flex justify-between items-center sticky top-0 z-30">
                        <div className="flex items-center gap-2"><img src={store.logoUrl} className="w-8 h-8 rounded"/> <span className="font-bold text-sm">{store.name}</span></div>
                        <div className="flex gap-2"><button onClick={()=>navigate('storefront', store.id)} className="text-blue-600 text-sm font-bold">Ver Loja</button><button onClick={()=>signOut(auth)}><LogOut size={18}/></button></div>
                    </header>
                    <div className="p-4 max-w-2xl mx-auto">
                        <div className="flex gap-2 mb-4 overflow-x-auto">
                            {[{k:'prod',l:'Produtos'},{k:'sub',l:'Assinatura'},{k:'conf',l:'Ajustes'}].map(x=>(
                                <button key={x.k} onClick={()=>setTab(x.k)} className={`px-4 py-2 rounded-full text-sm font-bold ${tab===x.k?'bg-slate-900 text-white':'bg-white border'}`}>{x.l}</button>
                            ))}
                        </div>

                        {tab==='prod' && (
                            store.paymentStatus!=='active' ? <div className="bg-white p-6 rounded-xl text-center shadow"><Lock className="mx-auto mb-2 text-amber-500"/><p>Loja Bloqueada. Pague a assinatura.</p></div> :
                            <div>
                                <form onSubmit={addP} className="bg-white p-4 rounded-xl shadow mb-4 grid grid-cols-2 gap-2">
                                    <input className="border p-2 rounded col-span-2" placeholder="Nome" value={newP.name} onChange={e=>setNewP({...newP, name:e.target.value})} required/>
                                    <input className="border p-2 rounded" type="number" placeholder="R$" value={newP.price} onChange={e=>setNewP({...newP, price:e.target.value})} required/>
                                    <input className="border p-2 rounded" placeholder="Img URL" value={newP.img} onChange={e=>setNewP({...newP, img:e.target.value})}/>
                                    <button className="bg-blue-600 text-white col-span-2 py-2 rounded font-bold">Adicionar</button>
                                </form>
                                {prods.map(p=>(<div key={p.id} className="bg-white p-3 rounded-xl shadow mb-2 flex items-center gap-3"><img src={p.image} className="w-12 h-12 rounded object-cover"/><div className="flex-1"><b>{p.name}</b><div className="text-green-600 text-sm">{formatBRL(p.price)}</div></div><button onClick={()=>delP(p.id)}><Trash2 size={16} class="text-red-400"/></button></div>))}
                            </div>
                        )}

                        {tab==='sub' && (
                            <div className="bg-white p-6 rounded-xl shadow text-center">
                                <Wallet className="mx-auto mb-2 text-blue-600" size={32}/>
                                <h3 className="font-bold text-lg">Assinatura: {store.paymentStatus==='active'?'ATIVA':'PENDENTE'}</h3>
                                <div className="bg-slate-100 p-3 rounded my-4 break-all font-mono text-sm">{pix||"Chave n칚o definida"}</div>
                                <p className="text-xs text-slate-500">Pague via Pix e contate o admin.</p>
                            </div>
                        )}

                        {tab==='conf' && (
                            <form onSubmit={saveConf} className="bg-white p-6 rounded-xl shadow space-y-3">
                                <div><label className="text-xs font-bold">Nome</label><input name="name" defaultValue={store.name} className="w-full border p-2 rounded"/></div>
                                <div><label className="text-xs font-bold">WhatsApp</label><input name="whatsapp" defaultValue={store.whatsapp} className="w-full border p-2 rounded"/></div>
                                <div><label className="text-xs font-bold">Cor</label><input name="color" type="color" defaultValue={store.themeColor} className="w-full h-10 rounded"/></div>
                                <button className="w-full bg-slate-900 text-white py-3 rounded font-bold">Salvar</button>
                            </form>
                        )}
                    </div>
                </div>
            );
        }

        function Storefront({ storeId, navigate, showToast }) {
            const [s, setS] = useState(null);
            const [p, setP] = useState([]);
            const [c, setC] = useState([]);
            const [cartOpen, setCartOpen] = useState(false);
            const [chk, setChk] = useState({n:'', m:'Pix'});

            useEffect(() => {
                if(!storeId || !db) return;
                onValue(ref(db, `artifacts/${APP_ID}/public/data/stores/${storeId}`), snap => snap.exists() && setS({id:snap.key, ...snap.val()}));
                onValue(query(ref(db, `artifacts/${APP_ID}/public/data/products`), orderByChild('storeId'), equalTo(storeId)), snap => setP(snapshotToArray(snap)));
            }, [storeId]);

            const add = (x) => { setC([...c, x]); showToast("Adicionado!"); setCartOpen(true); };
            const rem = (i) => setC(c.filter((_,idx)=>idx!==i));
            const tot = c.reduce((a,b)=>a+b.price,0);
            const end = () => {
                if(!s.whatsapp) return showToast("Loja sem WhatsApp", "error");
                if(!chk.n) return showToast("Nome obrigat칩rio", "error");
                const m = `*PEDIDO ${s.name}*\n游녻 ${chk.n}\n游눱 ${chk.m}\n--\n${c.map(i=>`1x ${i.name}`).join('\n')}\n--\nTotal: ${formatBRL(tot)}`;
                window.open(`https://wa.me/${s.whatsapp}?text=${encodeURIComponent(m)}`);
                setC([]); setCartOpen(false);
            };

            if(!s) return <div className="p-10 text-center">Carregando...</div>;

            return (
                <div className="min-h-screen bg-slate-50 font-sans pb-20">
                    <nav className="bg-white sticky top-0 z-30 px-4 h-16 flex justify-between items-center shadow-sm">
                        <div className="flex items-center gap-2"><img src={s.logoUrl} className="w-8 h-8 rounded"/><span className="font-bold">{s.name}</span></div>
                        <div className="flex gap-2">
                            <button onClick={()=>navigate('landing')}><X/></button>
                            <button onClick={()=>setCartOpen(true)} className="relative"><ShoppingBag/><span className="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center">{c.length}</span></button>
                        </div>
                    </nav>
                    <div style={{backgroundColor:s.themeColor}} className="h-32 w-full"></div>
                    <div className="px-4 -mt-10 grid grid-cols-2 gap-4">
                        {p.map(x=>(
                            <div key={x.id} className="bg-white rounded-xl shadow overflow-hidden flex flex-col">
                                <img src={x.image} className="h-32 object-cover"/>
                                <div className="p-3 flex-1 flex flex-col">
                                    <div className="font-bold text-sm leading-tight mb-1">{x.name}</div>
                                    <div className="mt-auto flex justify-between items-center pt-2 border-t">
                                        <span className="font-bold">{formatBRL(x.price)}</span>
                                        <button onClick={()=>add(x)} className="bg-slate-900 text-white p-1.5 rounded"><Plus size={16}/></button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                    {cartOpen && (
                        <div className="fixed inset-0 z-50 flex justify-end">
                            <div className="absolute inset-0 bg-black/30" onClick={()=>setCartOpen(false)}></div>
                            <div className="bg-white w-full max-w-sm z-10 h-full flex flex-col p-4">
                                <div className="flex justify-between border-b pb-4 mb-4"><h2 className="font-bold">Carrinho</h2><button onClick={()=>setCartOpen(false)}><X/></button></div>
                                <div className="flex-1 overflow-y-auto space-y-2">
                                    {c.map((x,i)=>(<div key={i} className="flex justify-between border p-2 rounded"><span>{x.name}</span><button onClick={()=>rem(i)}><Trash2 size={16} className="text-red-500"/></button></div>))}
                                </div>
                                <div className="mt-4 border-t pt-4">
                                    <div className="flex justify-between font-bold text-lg mb-4"><span>Total</span><span>{formatBRL(tot)}</span></div>
                                    {c.length>0 && <div className="space-y-2"><input className="border p-2 w-full rounded" placeholder="Nome" onChange={e=>setChk({...chk,n:e.target.value})}/><select className="border p-2 w-full rounded" onChange={e=>setChk({...chk,m:e.target.value})}><option>Pix</option><option>Dinheiro</option></select><button onClick={end} className="w-full bg-green-600 text-white py-3 rounded font-bold">Enviar Pedido</button></div>}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function Directory({ navigate }) {
            const [list, setList] = useState([]);
            useEffect(() => {
                if(db) onValue(ref(db, `artifacts/${APP_ID}/public/data/stores`), s => setList(snapshotToArray(s)));
            }, []);
            return (
                <div className="min-h-screen bg-slate-50 p-4">
                    <div className="flex gap-4 mb-6 items-center"><button onClick={()=>navigate('landing')} className="bg-white p-2 rounded shadow"><ChevronRight className="rotate-180"/></button><h1 className="text-2xl font-bold">Lojas</h1></div>
                    <div className="grid grid-cols-2 gap-4">
                        {list.map(s=>(<div key={s.id} onClick={()=>navigate('storefront', s.id)} className="bg-white p-4 rounded-xl shadow flex flex-col items-center text-center cursor-pointer"><img src={s.logoUrl} className="w-16 h-16 rounded mb-2"/><b>{s.name}</b></div>))}
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
